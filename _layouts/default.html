<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">

  {% seo %}
  {% include head-custom.html %}

</head>

<body>
  <!-- Spanish Red Bar Navigation -->
  <nav class="top-bar">
    <div class="nav-container">
      <!-- Logo and Site Title -->
      <a href="/" class="logo">
        <img src="/assets/images/MetroLogo2024.png" alt="MetroMan Logo" class="nav-logo">
        <span>{{ site.title | default: site.github.repository_name }}</span>
      </a>
      
      <!-- Mobile Menu Button -->
      <button class="mobile-menu-btn" aria-label="Toggle menu">â˜°</button>
      
      <!-- Main Navigation Menu -->
      <div class="nav-menu">
        <!-- Language Switcher -->
        <div class="language-switcher">
          <button class="language-btn" id="languageToggle">EN/ES</button>
        </div>
        
        <!-- Home Link (Single Item) -->
        <a href="/" class="nav-link" data-target="home">Inicio</a>
        
        <!-- Documentation Dropdown -->
        <div class="dropdown">
          <button class="dropbtn">Metro de Santiago</button>
          <div class="dropdown-content">
            <!-- Documentation Links - Edit these -->
           <a href="/comunidades/metro-de-santiago" class="nav-link" data-target="intro">Comunidad Metro de Santiago</a>            
            <a href="/MetroBot" class="nav-link" data-target="api">Referencia API</a>
            <!-- Add more documentation links as needed -->
          </div>
        </div>
        
        <!-- Examples Dropdown -->
        <div class="dropdown">
          <button class="dropbtn">Creaciones</button>
          <div class="dropdown-content">
            <!-- Example Links - Edit these -->
            <a href="/bloksel" class="nav-link" data-target="basicos">Bloksel</a>
            <a href="/balkeon"  class="nav-link" data-target="avanzados">Balkeon</a>
            
            <!-- Add more example links as needed -->
          </div>
        </div>
        
        <!-- Downloads Dropdown (Conditional) -->
        {% if site.show_downloads %}
        <div class="dropdown">
          <button class="dropbtn">Descargas</button>
          <div class="dropdown-content">
            <!-- Download Links - Edit these -->
            <a href="{{ site.github.zip_url }}">Descargar .zip</a>
            <a href="{{ site.github.tar_url }}">Descargar .tar.gz</a>
            <a href="/Balkeon-notes/downloads/extra" class="nav-link" data-target="extra">Archivos Extra</a>
            <!-- Add more download links as needed -->
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </nav>

  <!-- Loading Indicator -->
  <div id="loading" class="loading">
    <p>Cargando contenido...</p>
  </div>

  <!-- Content Area -->
  <div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
      {{ content }} <!-- Initial content -->
    </section>
  </div>

  <!-- Original Footer Preserved -->
  <!-- Social Media Footer -->
<div class="social-footer">

  <!-- Social Media Footer -->
<div class="social-footer">
  <h2 class="social-header">Mis Redes Sociales</h2>
  
  <div class="social-bubbles">
    <a href="https://www.youtube.com/c/MetroManCL" target="_blank" class="social-bubble" title="YouTube">
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_%282017%29.svg" alt="YouTube">
    </a>
    <a href="https://instagram.com/metroman.rrss" target="_blank" class="social-bubble" title="Instagram">
      <img src="https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg" alt="Instagram">
    </a>
    <a href="https://tiktok.com/@_.metroman._" target="_blank" class="social-bubble" title="TikTok">
      <img src="https://upload.wikimedia.org/wikipedia/commons/a/a9/TikTok_logo.svg" alt="TikTok">
    </a>
    <a href="https://twitch.tv/metromancl" target="_blank" class="social-bubble" title="Twitch">
      <img src="https://upload.wikimedia.org/wikipedia/commons/d/d3/Twitch_Glitch_Logo_Purple.svg" alt="Twitch">
    </a>
    <a href="https://www.facebook.com/metroman.rrss/" target="_blank" class="social-bubble" title="Facebook">
      <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="Facebook">
    </a>
    <a href="https://x.com/MetroManRRSS" target="_blank" class="social-bubble" title="X (Twitter)">
      <img src="https://upload.wikimedia.org/wikipedia/commons/5/5a/X_icon_2.svg" alt="X (Twitter)">
    </a>
    <a href="https://kick.com/metroman-rrss" target="_blank" class="social-bubble" title="Kick">
      <img src="https://upload.wikimedia.org/wikipedia/commons/4/4f/Kick_%28streaming_service%29_logo.svg" alt="Kick">
    </a>
    <a href="https://soundcloud.com/pandiepie-the-panda" target="_blank" class="social-bubble" title="SoundCloud">
      <img src="https://upload.wikimedia.org/wikipedia/commons/1/1b/Soundcloud_icon.svg" alt="SoundCloud">
    </a>
    <a href="https://bsky.app/profile/metroman.me" target="_blank" class="social-bubble" title="Bluesky">
      <img src="https://upload.wikimedia.org/wikipedia/commons/4/4f/Bluesky_logo_full_color.svg" alt="Bluesky">
    </a>
  </div>
</div>

<!-- Original Footer Preserved -->
<div id="footer_wrap" class="outer">
  <footer class="inner">
    {% if site.github.is_project_page %}
    <p class="copyright">
      <a href="{{ site.github.repository_url }}">{{ site.title | default: site.github.repository_name }}</a> 
      mantenido por <a href="{{ site.github.owner_url }}">{{ site.github.owner_name }}</a>
    </p>
    {% endif %}
    <p>Publicado con <a href="https://pages.github.com">GitHub Pages</a></p>
  </footer>
</div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Language detection and path management
      const currentPath = window.location.pathname;
      const isEnglish = currentPath.includes('/en/');
      const languageToggle = document.getElementById('languageToggle');
      
      // Set initial language button text
      languageToggle.textContent = isEnglish ? 'ES' : 'EN';
      
      // Function to toggle language paths
      function toggleLanguage() {
        const newPath = isEnglish ? 
          currentPath.replace('/en/', '/es/') : 
          '/en' + currentPath;
        
        // Check if the path exists before redirecting
        checkPathExists(newPath).then(exists => {
          if (exists) {
            window.location.href = newPath;
          } else {
            // Fallback to Spanish home if English path doesn't exist
            window.location.href = isEnglish ? '/' : '/en/';
          }
        });
      }
      
      // Function to check if a path exists
      function checkPathExists(path) {
        return fetch(path, { method: 'HEAD' })
          .then(res => res.ok)
          .catch(() => false);
      }
      
      // Language toggle event
      languageToggle.addEventListener('click', toggleLanguage);
      
      // Check browser language preference on first load
      if (!sessionStorage.getItem('languageChecked')) {
        const userPrefersEnglish = navigator.language.startsWith('en');
        const shouldRedirect = userPrefersEnglish && !isEnglish && currentPath === '/MetroMan/';
        
        if (shouldRedirect) {
          checkPathExists('/en/').then(exists => {
            if (exists) {
              window.location.href = '/en/';
            }
          });
        }
        
        sessionStorage.setItem('languageChecked', 'true');
      }
      
      // Mobile menu toggle
      const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
      const navMenu = document.querySelector('.nav-menu');
      
      mobileMenuBtn.addEventListener('click', function() {
        navMenu.classList.toggle('active');
      });
      
      // Dropdown functionality
      const dropdowns = document.querySelectorAll('.dropdown');
      
      dropdowns.forEach(dropdown => {
        const dropbtn = dropdown.querySelector('.dropbtn');
        
        // For desktop - hover
        dropdown.addEventListener('mouseenter', function() {
          if (window.innerWidth > 768) {
            this.classList.add('active');
          }
        });
        
        dropdown.addEventListener('mouseleave', function() {
          if (window.innerWidth > 768) {
            this.classList.remove('active');
          }
        });
        
        // For mobile - click
        dropbtn.addEventListener('click', function(e) {
          if (window.innerWidth <= 768) {
            e.preventDefault();
            const isActive = this.parentElement.classList.contains('active');
            
            // Close all other dropdowns
            dropdowns.forEach(d => {
              if (d !== dropdown) d.classList.remove('active');
            });
            
            // Toggle current dropdown
            dropdown.classList.toggle('active');
          }
        });
      });
      
      // Dynamic Content Loading with language prefix handling
      const navLinks = document.querySelectorAll('.nav-link');
      const mainContent = document.getElementById('main_content');
      const loadingIndicator = document.getElementById('loading');
      
      navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          let url = this.getAttribute('href');
          
          // Add language prefix if in English mode
          if (isEnglish && !url.includes('/en/')) {
            url = url.replace('/', '/en/');
          }
          
          // Close mobile menu if open
          if (window.innerWidth <= 768) {
            navMenu.classList.remove('active');
          }
          
          // Show loading indicator
          loadingIndicator.style.display = 'block';
          mainContent.style.display = 'none';
          
          // Fetch the content
          fetch(url)
            .then(response => {
              if (!response.ok) {
                // If English page doesn't exist, try Spanish version
                if (isEnglish && url.includes('/en/')) {
                  const spanishUrl = url.replace('/en/', '/');
                  return fetch(spanishUrl);
                }
                throw new Error('Network response was not ok');
              }
              return response;
            })
            .then(response => response.text())
            .then(html => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, 'text/html');
              const newContent = doc.querySelector('#main_content').innerHTML;
              
              mainContent.innerHTML = newContent;
              history.pushState({ content: newContent }, '', url);
              
              loadingIndicator.style.display = 'none';
              mainContent.style.display = 'block';
            })
            .catch(error => {
              console.error('Error loading content:', error);
              loadingIndicator.style.display = 'none';
              window.location.href = url;
            });
        });
      });
      
      // Handle back/forward navigation
      window.addEventListener('popstate', function(e) {
        if (e.state && e.state.content) {
          mainContent.innerHTML = e.state.content;
        } else {
          window.location.reload();
        }
      });
    });
  </script>
</body>
</html>
